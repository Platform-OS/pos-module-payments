query search(
  $id: ID
  $limit: Int = 20
  $order_ids: [String!]
) {
  transactions: records(
    per_page: $limit
    filter: {
      id: { value: $id }
      table: { value: "transaction" }
      properties: [
        { name: "order_ids" array_contains: $order_ids }
      ]
    }
    sort: [
      { created_at: { order: DESC }}
    ]
  ){
    total_entries
    results {
      id
      created_at
      type: table
      profile_id: property(name: "profile_id")
      order_ids: property_array(name: "order_ids")
      amount: property_int(name: "amount")
      currency: property(name: "currency")
      gateway: property(name: "gateway")

      status: related_record(
        join_on_property: "id"
        foreign_property: "object_id"
        table: "status"
        sort: { properties: { name: "name", order: ASC } }
      ) {
        id
        created_at
        name: property(name: "name")
        timestamp: property(name: "timestamp")
      }

      create_bill_gateway_request: related_record(
        join_on_property: "id"
        foreign_property: "external_id"
        table: "gateway_request"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "mobicash_checkout_create_bill" }
        }
      ) {
        id
        created_at
        response: property(name: "response")
      }
      update_bill_gateway_request: related_record(
        join_on_property: "id"
        foreign_property: "external_id"
        table: "gateway_request"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "mobicash_update_bill_status" }
        }
      ) {
        id
        created_at
        payload: property(name: "payload")
      }

      get_bill_status: related_record(
        join_on_property: "id"
        foreign_property: "external_id"
        table: "gateway_request"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "mobicash_checkout_get_bill_status" }
        }
      ) {
        id
        created_at
        response: property(name: "response")
      }

      neo_payment_intent_gateway_request: related_record(
        table: "gateway_request"
        join_on_property: "id", foreign_property: "external_id"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "neo_payment_intent" }
        }
      ) {
        id
        created_at
        type: table

        gateway: property(name: "gateway")
        external_id: property(name: "external_id")
        payload: property(name: "payload")
        response: property(name: "response")
        response_status: property(name: "response_status")
        api_call_name: property(name: "api_call_name")
      }

      neo_payment_status_gateway_request: related_record(
        table: "gateway_request"
        join_on_property: "id", foreign_property: "external_id"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "neo_payment_status" }
        }
      ) {
        id
        created_at
        type: table

        gateway: property(name: "gateway")
        external_id: property(name: "external_id")
        payload: property(name: "payload")
        response: property(name: "response")
        response_status: property(name: "response_status")
        api_call_name: property(name: "api_call_name")
      }

      cybersource_payment_status_gateway_request: related_record(
        table: "gateway_request"
        join_on_property: "id", foreign_property: "external_id"
        sort: { created_at: { order: DESC } }
        filter: {
          properties: { name: "api_call_name" value: "cybersource_update_bill_status" }
        }
      ) {
        id
        created_at
        type: table

        gateway: property(name: "gateway")
        external_id: property(name: "external_id")
        payload: property(name: "payload")
        response: property(name: "response")
        response_status: property(name: "response_status")
        api_call_name: property(name: "api_call_name")
      }

      cybersource_payment_status_gateway_requests: related_records(
        table: "gateway_request"
        join_on_property: "id", foreign_property: "external_id"
        sort: { created_at: { order: DESC } }
        filter: {
          properties: { name: "api_call_name" value: "cybersource_update_bill_status" }
        }
      ) {
        id
        created_at
        type: table

        gateway: property(name: "gateway")
        external_id: property(name: "external_id")
        payload: property(name: "payload")
        response: property(name: "response")
        response_status: property(name: "response_status")
        api_call_name: property(name: "api_call_name")
      }

      voucher_process_gateway_request: related_record(
        table: "gateway_request"
        join_on_property: "id", foreign_property: "external_id"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "voucher_process" }
        }
      ) {
        id
        created_at
        type: table

        gateway: property(name: "gateway")
        external_id: property(name: "external_id")
        payload: property(name: "payload")
        response: property(name: "response")
        response_status: property(name: "response_status")
        api_call_name: property(name: "api_call_name")
      }
    }
  }
}
