query search(
  $id: ID
  $limit: Int = 20
) {
  transactions: records(
    per_page: $limit
    filter: {
      id: { value: $id }
      table: { value: "transaction" }
    }
    sort: [
      { created_at: { order: DESC }}
    ]
  ){
    total_entries
    results {
      id
      created_at
      type: table
      profile_id: property(name: "profile_id")
      order_ids: property_array(name: "order_ids")
      amount: property_int(name: "amount")
      currency: property(name: "currency")
      gateway: property(name: "gateway")

      status: related_record(
        join_on_property: "id"
        foreign_property: "object_id"
        table: "status"
        sort: { properties: { name: "name", order: ASC } }
      ) {
        id
        created_at
        name: property(name: "name")
        timestamp: property(name: "timestamp")
      }

      buyer: related_record(
        join_on_property: "profile_id"
        foreign_property: "id"
        table: "profile"
      ) {
        id
        name: property(name: "name")
        first_name: property(name: "first_name")
        last_name: property(name: "last_name")
        phone: property(name: "phone")
        user: related_user(join_on_property: "user_id", foreign_property: "id") {
          id
          email
        }
      }

      create_bill_gateway_request: related_record(
        join_on_property: "id"
        foreign_property: "external_id"
        table: "gateway_request"
        sort: { created_at: { order: ASC } }
        filter: {
          properties: { name: "api_call_name" value: "mobicash_checkout_create_bill" }
        }
      ) {
        id
        created_at
        response: property(name: "response")
        response_status: property(name: "response_status")
      }

      orders: related_records(table: "order", join_on_property: "order_ids", foreign_property: "id"){
        id
        created_at
        total_price_cents: property_int(name: "total_price_cents")
        total_shipping_cost_cents: property_int(name: "total_shipping_cost_cents")
        products_price_cents: property_int(name: "products_price_cents")
        currency: property(name: "currency")

        status: related_record(
          join_on_property: "id"
          foreign_property: "object_id"
          table: "status"
          sort: { created_at: { order: ASC } }
        ) {
          id
          created_at
          name: property(name: "name")
          timestamp: property(name: "timestamp")
        }

        seller: related_record(
          join_on_property: "seller"
          foreign_property: "id"
          table: "organization"
        ) {
          id
          name: property(name: "name")
        }

        line_items: related_records(
          join_on_property: "id"
          foreign_property: "order_id"
          table: "line_item"
          sort: { properties: { name: "name", order: ASC } }
        ) {
          id
          created_at
          item_id: property(name: "item_id")
          quantity: property_int(name: "quantity")
          price_cents: property_int(name: "price_cents")
          currency: property(name: "currency")
          total_price_cents: property_int(name: "total_price_cents")

          item: related_record(
            join_on_property: "item_id"
            foreign_property: "id"
            table: "item"
          ) {
            id
            category: property(name: "category")
            item_detail: related_record(
              table: "item_detail"
              join_on_property: "id"
              foreign_property: "item_id"
              filter: { properties: { name: "lang", value: "en" } }
            ) {
              id
              type: table
              name: property(name: "name")
              description: property(name: "description")
            }

            item_inventory: related_record(
              table: "item_inventory"
              join_on_property: "item_inventory_id"
              foreign_property: "id"
            ) {
              id
              type: table
              item_id: property(name: "item_id")
              sku: property(name: "sku")
            }
          }
        }
      }
    }
  }
}
