{%  liquid
  function object = 'modules/payments/commands/transactions/update_status/build', object: object, transaction: transaction
  function object = 'modules/payments/commands/transactions/update_status/check', object: object

  if object.valid
    if object.name == 'app.statuses.transactions.success'
      assign event_payload = null | hash_merge: transaction_id: transaction.id
      function _ = 'modules/core/commands/events/publish', type: 'payments_transaction_succeeded', object: event_payload
    endif
  endif

  return object
%}
