{% liquid
  # Params:
  #   transaction

  assign gateway_is_configured_function = 'modules/' | append: transaction.gateway | append: '/helpers/is_configured'
  function gateway_configured = gateway_is_configured_function
  if gateway_configured
    assign gateway_pay_url_function = 'modules/' | append: transaction.gateway | append: '/helpers/pay_url'
    function url = gateway_pay_url_function, transaction: transaction
  else
    unless context.environment == 'production'
      if use_fallback
        assign gateway_pay_url_function = 'modules/' | append: use_fallback | append: '/helpers/pay_url'
        function url = gateway_pay_url_function
      endif
    endunless
  endif

  return url
%}
